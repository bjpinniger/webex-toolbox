{% extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}
{% from "_render_field.html" import render_field %}

{% block app_content %}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<div class="container">
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Active Members</h4>
            </div>
            <div class="modal-body">
                <div id="spinner" class="loader" align="center"></div>
                <p id="warning"></p>
                <ul id="content" class="list-group"></ul>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-xs-1 col-md-2 col-lg-3"></div>
        <div class="col-xs-10 col-md-8 col-lg-6">
            <h2 style = "text-align: center;">Leave spaces</h2>
            <hr>
            <p></p>
            <div class="col text-center">
                <button type="button" id="myBtn" class="btn btn-primary" data-toggle="modal" data-target="#myModal" style = "align-content : center;">View Members</button>
            </div>
            <form action="" method="post" class="form" role="form">
                {{ form.csrf_token() }}
                <dl>
                    {{ render_field(form.space) }}
                </dl>
            <p><input type=submit class='btn btn-danger btn-block' value="Leave Space"></p>
            </form>
        </div>
        <div class="col-xs-1 col-md-2 col-lg-3"></div>
    </div>
</div>
<script>
var btn = document.getElementById("myBtn");
var space = document.getElementById("space");
var content = document.getElementById("content");
var warning = document.getElementById("warning");

btn.onclick = function() {
    spaceID = space.value;
    console.log(spaceID.length);
    if(spaceID.length == 0){
        document.getElementById("spinner").style.display = "none";
        warning.innerHTML = "Select a space to see the active members.";
        }
    else {
        document.getElementById("spinner").style.display = "";
        warning.innerHTML = '';
        while(content.hasChildNodes())
            {
            content.removeChild(content.firstChild);
            }
        spaceId = space.value;    
        fetch('/member_details/' + spaceId).then(function(response) {
        response.json().then(function(data) {
            document.getElementById("spinner").style.display = "none";
            for (var user of data.members) {
                var listItem = document.createElement('li');
                listItem.setAttribute('class','list-group-item');
                listItem.innerHTML = ((user.DisplayName) + " - " + (user.Email));
                content.appendChild(listItem);
                }
            })
        });
    }
}
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
{% endblock %}