{% extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}
{% from "_render_field.html" import render_field %}

{% block app_content %}
<div class="container" style="width: 50%;">
    <h2 style = "text-align: center;">Webex Meetings</h2>
    <hr>
    <form action="" method="post" class="form" role="form">
        {{ form.csrf_token() }}
        <d1>
            {{ render_field(form.type) }}
            {{ render_field(form.start_date) }}
        </d1>
    <p><input type=button id="submit" class='btn btn-primary btn-block' value="Submit"></p>
    </form>
</div>
<div id="Rows-Group" class="form-group" style = "padding: 10pt;" align="center">
    <select id="maxRows" name="state" class="form-control" style="width:150px;">
        <option value="10">10 rows</option>
        <option value="15">15 rows</option>
        <option value="20">20 rows</option>
        <option value="30">50 rows</option>  
    </select>
</div>
<div id="report" class="container" align="center" style="width: 100%;" >
    <table id="WbxReport" class="table table-bordered table-striped">
    </table>
    <div class='pagination-container' >
        <nav>
            <ul class="pagination"></ul>
        </nav>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<script src="static/js/bootstrap.min.js"></script>
<script>
$(document).ready(function() {
    var x = document.getElementById("Rows-Group");
    x.style.display = "none";
});
</script>

<script>
var x = document.getElementById("Rows-Group");
var report_table = document.getElementById("WbxReport");
var type_select = document.getElementById("type");
var startdate = document.getElementById("start_date");
var submit_button = document.getElementById("submit");

submit_button.onclick = function()  {
    while(report_table.hasChildNodes())
        {
        report_table.removeChild(report_table.firstChild);
        }
    
    Report_Type = type_select.value;
    Start_Date = startdate.value;
    
    fetch('/reports/'+ Report_Type + '/' + Start_Date).then(function(response) {
        response.json().then(function(data) {
            //display select field
            x.style.display = "";

            var body = report_table.create
            for (var mtg of data.meetings) {
                var row = report_table.insertRow(0);
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);
                var cell5 = row.insertCell(4);
                cell1.innerHTML = mtg.key;
                cell2.innerHTML = mtg.title;
                cell3.innerHTML = mtg.host;
                cell4.innerHTML = mtg.startdate;
                cell5.innerHTML = mtg.duration;
            }
            // create header
            var header = report_table.createTHead();
            var row = header.insertRow(0);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            var cell4 = row.insertCell(3);
            var cell5 = row.insertCell(4);
            cell1.innerHTML = "<b>Meeting ID</b>";
            cell2.innerHTML = "<b>Title</b>";
            cell3.innerHTML = "<b>Host</b>";
            cell4.innerHTML = "<b>Start Date</b>";
            cell5.innerHTML = "<b>Duration (mins)</b>";

            paginate(10);
        })
    });
}

$('#maxRows').on('change', function(){
    var maxRows = parseInt($(this).val())
    paginate(maxRows);
})

function paginate(maxRows) {
    var table = '#mytable';
    var x = document.getElementById("maxRows");
    $('.pagination').html('')
    var trnum = 0
    var totalRows = ($('#WbxReport tr').length);
    for (trnum = 0; trnum < totalRows; trnum++) {
        if(trnum > maxRows){
            document.querySelectorAll('#WbxReport tr')[trnum].style.display = "none";
        }
        if(trnum <= maxRows){
            document.querySelectorAll('#WbxReport tr')[trnum].style.display = "";
        }
    }
    if(totalRows > maxRows){
        var pagenum = Math.ceil(totalRows/maxRows)
        for(var i=1;i<=pagenum;){
            $('.pagination').append('<li data-page="'+i+'">\<span>'+ i++ +'<span class="sr-only">(current)</span></span>\</li>').show()
        }
    }
    $('.pagination li:first-child').addClass('active')
    $('.pagination li').on('click',function(){
        var pageNum = $(this).attr('data-page')
        var trIndex;
        $('.pagination li').removeClass('active')
        $(this).addClass('active')
        var totalRows = ($('#WbxReport tr').length);
        console.log ("rows = " + totalRows)
        for (trIndex = 1; trIndex < totalRows; trIndex++) {
            if(trIndex > (maxRows*pageNum) || trIndex <= ((maxRows*pageNum)-maxRows)){
                document.querySelectorAll('#WbxReport tr')[trIndex].style.display = "none";
            } else{
                document.querySelectorAll('#WbxReport tr')[trIndex].style.display = "";
            }
        }
    })
}
</script>
{% endblock %}